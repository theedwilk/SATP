/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
const sendAnalytics=(e,t)=>{try{t={...t,domain:domain},chrome.runtime.sendMessage({main_op:"analytics",analytics:[[e,t]]})}catch(e){}};let domain="",prevZoomLevel="";const ACROBAT_ICON_CLASS="acrobat-embedded-pdf-icon";if(window.self!==window.top){const e=new Map;e.set(528,{top:18,right:125,height:20,width:20}),e.set(469,{top:16,right:110,height:18,width:18}),e.set(423,{top:14,right:99,height:16,width:16}),e.set(336,{top:12,right:80,height:12,width:12}),e.set(274,{top:10,right:76,height:12,width:12}),e.set(228,{top:9,right:66,height:10,width:10}),e.set(160,{top:7,right:54,height:8,width:8}),e.set(141,{top:6,right:44,height:6,width:6}),e.set(87,{top:5,right:34,height:4,width:4}),e.set(50,{top:3.5,right:26,height:4,width:4});const t=t=>{if(prevZoomLevel!==window.devicePixelRatio){if(""!==prevZoomLevel&&sendAnalytics("DCBrowserExt:EmbeddedPDF:ZoomLevel:Changed"),""===prevZoomLevel&&window.innerWidth<=500)return t.style.top="16px",t.style.right="118px",t.getElementsByClassName(ACROBAT_ICON_CLASS)[0].style.height="20px",void(t.getElementsByClassName(ACROBAT_ICON_CLASS)[0].style.width="20px");for(let[o,d]of e)if(window.innerWidth>=o){t.style.top=`${d.top}px`,t.style.right=`${d.right}px`,t.getElementsByClassName(ACROBAT_ICON_CLASS)[0].style.height=`${d.height}px`,t.getElementsByClassName(ACROBAT_ICON_CLASS)[0].style.width=`${d.width}px`;break}prevZoomLevel=window.devicePixelRatio}},o=e=>{const t=document.createElement("div");return t.setAttribute("class","acrobat-embedded-pdf-touch-point-tooltip"),t.innerText=e?.touchPointText||"Open in Acrobat",t},d=()=>{const e=document.createElement("img");return e.setAttribute("src",chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png")),e.classList.add(ACROBAT_ICON_CLASS),e},i=e=>{sendAnalytics("DCBrowserExt:EmbeddedPDF:TouchPoint:Clicked"),chrome.storage.local.set({embeddedPDFTouchPointFTEState:{touchPointClicked:!0}});const t=new URL(e);t.searchParams.set("acrobatPromotionSource","embeddedPDF");const o=chrome.runtime.getURL("viewer.html")+`?pdfurl=${encodeURIComponent(t.toString())}`;window.open(o)},n=e=>{const t=document.createElement("button"),n=d();return t.appendChild(n),t.appendChild(o(e)),t.addEventListener("click",(()=>i(window.location.href))),t.setAttribute("tabIndex","1"),t},s=async e=>{if(e?.enableEmbeddedPDFTouchPoint){if(window.innerHeight<250||window.innerWidth<201)return void sendAnalytics("DCBrowserExt:EmbeddedPDF:TopNavNotPresent:WidthHeight");chrome.storage.local.set({[`${e?.tabId}-embedded-pdf-touch-point`]:{visible:!0,frameId:e?.frameId}});const o=n(e);document.body.appendChild(o),o.classList.add("acrobat-embedded-pdf-touch-point"),sendAnalytics("DCBrowserExt:EmbeddedPDF:TouchPoint:Shown"),window.addEventListener("resize",(()=>{t(o)})),t(o)}},r=async()=>{const e=await import(chrome.runtime.getURL("content_scripts/gsuite/fte-utils.js")),t=await chrome.runtime.sendMessage({main_op:"embedded-pdf-touch-point-config"}),o=document.getElementsByClassName("acrobat-embedded-pdf-touch-point"),d=document.getElementsByClassName("acrobat-fte-tooltip");if(o?.length>0&&0===d?.length){const d=e.createFteTooltip(t?.fteToolTipStrings,"embeddedPDF");o[0].appendChild(d),sendAnalytics("DCBrowserExt:EmbeddedPDF:FTE:Shown");d.querySelector(".acrobat-fte-tooltip-button").addEventListener("click",(()=>{d?.remove(),sendAnalytics("DCBrowserExt:EmbeddedPDF:FTE:Closed")})),e?.updateFteToolTipCoolDown(t?.fteConfig?.tooltip,"embeddedPDFTouchPointFTEState")}},a=async(e,t)=>{const o=await chrome.runtime.sendMessage({main_op:"embedded-pdf-touch-point-config"});o?.enableEmbeddedPDFTouchPoint&&sendAnalytics("DCBrowserExt:EmbeddedPDFs:TouchPoint:Enabled"),"NativeViewer"!==e||t||s(o)};if(chrome.runtime.onMessage.addListener((e=>{"add-fte-for-embedded-pdf-touch-point"===e?.type&&r()})),document?.contentType?.includes("application/pdf")){const e=new URL(window.location.href),t=e?.hash?.includes("toolbar=0");domain=e.hostname;let o="Unknown";document.body?.childNodes?.length>0&&document.body.childNodes[0]?.getAttribute("src")?.startsWith("chrome-extension://dahenjhkoodjbpjheillcadbppiidmhp")?o="GoogleScholar":document.body?.childNodes?.length>0&&"about:blank"===document.body.childNodes[0]?.getAttribute("src")&&(o="NativeViewer"),sendAnalytics("DCBrowserExt:Viewer:Detected:EmbededPDF:IframeContentType",{eventContext:`${o}-${!t}`}),a(o,t)}}